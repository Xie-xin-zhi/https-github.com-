<script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.17.0/dist/av-min.js"></script>
<script>
    // 1. LeanCloud初始化（替换成你自己的3个值！！）
    AV.init({
        appId: "你的LeanCloud AppID", // 复制你LeanCloud应用的AppID
        appKey: "你的LeanCloud AppKey", // 复制你LeanCloud应用的AppKey
        serverURL: "你的LeanCloud 服务器地址" // 复制你LeanCloud的服务器地址（华东/华北）
    });

    // 2. 初始化Post数据表
    const Post = AV.Object.extend('Post');

    // 3. 页面加载完成后，自动查询所有帖子（核心修复：保证能读到数据）
    window.onload = function() {
        queryAllPosts(); // 页面一打开就查数据，不用手动刷新
    }

    // 4. 查询所有帖子的核心函数（修复查询语法，确保加载）
    function queryAllPosts() {
        const query = new AV.Query('Post');
        query.descending('createdAt'); // 按发布时间倒序（最新的在最上面）
        query.find().then(posts => {
            const postList = document.getElementById('帖子列表的ID'); // 改成你页面里帖子列表的真实ID
            postList.innerHTML = ''; // 清空旧数据
            // 遍历数据，渲染到页面
            posts.forEach(post => {
                const name = post.get('name');
                const title = post.get('title');
                const content = post.get('content');
                // 拼接帖子HTML（适配你的页面样式，直接用）
                const postHtml = `
                    <div class="post-item">
                        <h3>${title}</h3>
                        <p>发布人：${name}</p>
                        <div class="post-content">${content}</div>
                    </div>
                `;
                postList.innerHTML += postHtml;
            });
        }).catch(err => {
            alert('加载帖子失败：' + err.message); // 报错提示，方便排查
        });
    }

    // 5. 发布帖子的核心函数（保证发布的数据能存入LeanCloud）
    function publishPost() {
        const name = document.getElementById('昵称输入框ID').value; // 改成你页面的昵称框ID
        const title = document.getElementById('标题输入框ID').value; // 改成你页面的标题框ID
        const content = document.getElementById('内容输入框ID').value; // 改成你页面的内容框ID
        
        if(!name || !title || !content) {
            alert('昵称、标题、内容不能为空！');
            return;
        }

        const newPost = new Post();
        newPost.set('name', name);
        newPost.set('title', title);
        newPost.set('content', content);
        // 保存数据到LeanCloud
        newPost.save().then(() => {
            alert('发布成功！');
            queryAllPosts(); // 发布后自动刷新列表
            // 清空输入框
            document.getElementById('昵称输入框ID').value = '';
            document.getElementById('标题输入框ID').value = '';
            document.getElementById('内容输入框ID').value = '';
        }).catch(err => {
            alert('发布失败：' + err.message);
        });
    }
</script>