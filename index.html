<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœé˜³å¤–å›½è¯­17ç­ - ç­çº§è®ºå›</title>
    <style>
        * {margin: 0;padding: 0;box-sizing: border-box;font-family: "Microsoft YaHei", sans-serif;}
        body {background-color: #f5f7fa;color: #333;line-height: 1.6;}
        header {background-color: #2c5282;color: white;padding: 1rem 0;box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
        .header-container {max-width: 1200px;margin: 0 auto;padding: 0 20px;display: flex;justify-content: space-between;align-items: center;}
        .class-title {font-size: 1.8rem;font-weight: bold;}
        .nav-links a {color: white;text-decoration: none;margin-left: 20px;font-size: 1rem;}
        .nav-links a:hover {color: #e6f7ff;}
        .container {max-width: 1200px;margin: 2rem auto;padding: 0 20px;display: grid;grid-template-columns: 3fr 1fr;gap: 2rem;}
        .notice {background-color: #fff;padding: 1.5rem;border-radius: 8px;box-shadow: 0 2px 8px rgba(0,0,0,0.08);margin-bottom: 2rem;border-left: 4px solid #4299e1;}
        .notice h3 {color: #2c5282;margin-bottom: 10px;display: flex;align-items: center;}
        .notice-content {color: #555;font-size: 0.95rem;}
        .posts {background-color: #fff;border-radius: 8px;box-shadow: 0 2px 8px rgba(0,0,0,0.08);overflow: hidden;}
        .post-header {padding: 1rem 1.5rem;background-color: #f8f9fa;border-bottom: 1px solid #eee;display: flex;justify-content: space-between;align-items: center;}
        .post-header h2 {color: #2c5282;font-size: 1.2rem;}
        .post-item {padding: 1.5rem;border-bottom: 1px solid #eee;}
        .post-item:last-child {border-bottom: none;}
        .post-title {font-size: 1.1rem;font-weight: 600;color: #2c5282;margin-bottom: 8px;}
        .post-meta {font-size: 0.85rem;color: #999;margin-bottom: 10px;display: flex;gap: 15px;}
        .post-content {color: #555;margin-bottom: 15px;}
        .post-actions {display: flex;gap: 20px;font-size: 0.85rem;}
        .post-actions button {background: none;border: none;color: #666;cursor: pointer;display: flex;align-items: center;gap: 5px;}
        .post-actions button:hover {color: #4299e1;}
        .post-form {background-color: #fff;padding: 1.5rem;border-radius: 8px;box-shadow: 0 2px 8px rgba(0,0,0,0.08);margin-bottom: 2rem;}
        .post-form h3 {color: #2c5282;margin-bottom: 15px;font-size: 1.1rem;}
        .author-input {margin-bottom: 15px;}
        .author-input label {display: block;margin-bottom: 5px;color: #666;font-size: 0.95rem;}
        .author-input input {width: 100%;padding: 10px;border: 1px solid #ddd;border-radius: 4px;font-size: 0.95rem;}
        .form-group {margin-bottom: 15px;}
        .form-group label {display: block;margin-bottom: 5px;color: #666;font-size: 0.95rem;}
        .form-group input,.form-group textarea {width: 100%;padding: 10px;border: 1px solid #ddd;border-radius: 4px;font-size: 0.95rem;resize: vertical;}
        .form-group textarea {min-height: 120px;}
        .submit-btn {background-color: #4299e1;color: white;border: none;padding: 10px 20px;border-radius: 4px;cursor: pointer;font-size: 0.95rem;}
        .submit-btn:hover {background-color: #3182ce;}
        .sidebar {display: flex;flex-direction: column;gap: 2rem;}
        .sidebar-card {background-color: #fff;padding: 1.5rem;border-radius: 8px;box-shadow: 0 2px 8px rgba(0,0,0,0.08);}
        .sidebar-card h3 {color: #2c5282;margin-bottom: 15px;font-size: 1.1rem;border-bottom: 1px solid #eee;padding-bottom: 10px;}
        .class-info {list-style: none;}
        .class-info li {margin-bottom: 10px;display: flex;align-items: center;gap: 8px;color: #666;}
        footer {background-color: #2c5282;color: white;text-align: center;padding: 1.5rem 0;margin-top: 3rem;}
        .footer-content {max-width: 1200px;margin: 0 auto;padding: 0 20px;font-size: 0.9rem;}
        @media (max-width: 768px) {.container {grid-template-columns: 1fr;}.class-title {font-size: 1.5rem;}.header-container {flex-direction: column;gap: 10px;}.nav-links {margin-top: 10px;}}
        .loading {padding: 2rem;text-align: center;color: #666;}
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="class-title">æœé˜³å¤–å›½è¯­17ç­ - ç­çº§è®ºå›</div>
            <nav class="nav-links">
                <a href="#home">é¦–é¡µ</a>
                <a href="#notice">å…¬å‘Š</a>
                <a href="#post">å‘å¸–</a>
                <a href="#contact">è”ç³»æˆ‘ä»¬</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <section class="notice" id="notice">
                <h3>ç­çº§å…¬å‘Š</h3>
                <div class="notice-content">
                    <p>ğŸ’¬ ã€æé†’ã€‘ç­çº§è®ºå›å·²ä¸Šçº¿ï¼Œæ¬¢è¿å¤§å®¶ç§¯æäº¤æµå­¦ä¹ å¿ƒå¾—ã€åˆ†äº«ç­çº§è¶£äº‹ï¼</p>
                </div>
            </section>

            <section class="post-form" id="post">
                <h3>å‘å¸ƒæ–°å¸–å­</h3>
                <form id="newPostForm">
                    <div class="author-input">
                        <label for="postAuthor">ä½ çš„åå­—</label>
                        <input type="text" id="postAuthor" placeholder="è¯·è¾“å…¥ä½ çš„æ˜µç§°/å§“å" required>
                    </div>
                    <div class="form-group">
                        <label for="postTitle">å¸–å­æ ‡é¢˜</label>
                        <input type="text" id="postTitle" placeholder="è¯·è¾“å…¥å¸–å­æ ‡é¢˜" required>
                    </div>
                    <div class="form-group">
                        <label for="postContent">å¸–å­å†…å®¹</label>
                        <textarea id="postContent" placeholder="è¯·è¾“å…¥å¸–å­è¯¦ç»†å†…å®¹..." required></textarea>
                    </div>
                    <button type="submit" class="submit-btn">å‘å¸ƒå¸–å­</button>
                </form>
            </section>

            <section class="posts" id="home">
                <div class="post-header">
                    <h2>ç­çº§å¸–å­åˆ—è¡¨</h2>
                    <span>å…± <span id="postCount">0</span> æ¡å¸–å­</span>
                </div>
                <div class="loading" id="loading">åŠ è½½å¸–å­ä¸­...</div>
            </section>
        </div>

        <div class="sidebar">
            <div class="sidebar-card">
                <h3>ç­çº§ä¿¡æ¯</h3>
                <ul class="class-info">
                    <li>å­¦æ ¡ï¼šæœé˜³å¤–å›½è¯­å­¦æ ¡</li>
                    <li>ç­çº§ï¼šåˆä¸€å¹´çº§17ç­</li>
                    <li>ç­ä¸»ä»»ï¼šç‹è€å¸ˆ</li>
                    <li>ç­çº§é‚®ç®±ï¼šcywy17ban@163.com</li>
                    <li>æˆç«‹æ—¶é—´ï¼š2025å¹´12æœˆ</li>
                </ul>
            </div>
            <div class="sidebar-card">
                <h3>çƒ­é—¨è¯é¢˜</h3>
                <ul class="class-info">
                    <li>ç­çº§ç”·ç”Ÿå†…æ–—</li>
                    <li>åƒµå°¸ç»„ç»‡è§£æ•£</li>
                    <li>æœå¤–ç¥äººæ¦œå…³é—­</li>
                    <li>æœŸæœ«è€ƒè¯•ä¸´è¿‘</li>
                </ul>
            </div>
        </div>
    </div>

    <footer id="contact">
        <div class="footer-content">
            <p>æœé˜³å¤–å›½è¯­17ç­è®ºå› Â© 2025 ç‰ˆæƒæ‰€æœ‰ | æœ¬è®ºå›ä»…ç”¨äºç­çº§å†…éƒ¨äº¤æµ</p>
            <p>è”ç³»æˆ‘ä»¬ï¼šdongpingping@foxmail.com</p>
        </div>
    </footer>

    <script>
        // ================ âœ… å·²å†…ç½®ä½ çš„è…¾è®¯æ–‡æ¡£é“¾æ¥ï¼Œæ— éœ€ä¿®æ”¹ ================
        const TENCENT_TABLE_URL = "https://docs.qq.com/sheet/DT0RsV0V1ekVCSUx0?tab=BB08J2";
        // æœ¬åœ°å­˜å‚¨+è¡¨æ ¼åŒæ•°æ®æºï¼Œä¿è¯æ•°æ®æ°¸ä¸ä¸¢å¤±
        let postDataList = [];

        // é¡µé¢åŠ è½½ç«‹å³æ‰§è¡Œï¼šåŠ è½½è¡¨æ ¼æ•°æ® + æœ¬åœ°ç¼“å­˜æ•°æ®
        window.addEventListener('load', async () => {
            await initAllData();
            renderPostsToPage();
        });

        // âœ… æ ¸å¿ƒ1ï¼šåˆå§‹åŒ–æ•°æ®ã€è¡¨æ ¼æ•°æ® + æœ¬åœ°ç¼“å­˜ åŒä¿é™©ã€‘
        async function initAllData() {
            // 1. ä¼˜å…ˆè¯»å–æœ¬åœ°ç¼“å­˜ï¼ˆä¿è¯åˆ·æ–°/é‡å¯é¡µé¢æ•°æ®ä¸ä¸¢ï¼‰
            const localData = localStorage.getItem('classBBS_posts');
            if (localData) {
                postDataList = JSON.parse(localData);
            }

            // 2. è¯»å–è…¾è®¯è¡¨æ ¼æ•°æ®ï¼ˆåå°æ‰‹åŠ¨æ”¹çš„æ•°æ®åŒæ­¥åˆ°å‰ç«¯ï¼‰
            try {
                // å…¼å®¹è…¾è®¯æ–‡æ¡£æ ¼å¼ï¼Œè‡ªåŠ¨è·å–è¡¨æ ¼æ•°æ®
                const tableRes = await fetch(TENCENT_TABLE_URL);
                const tableText = await tableRes.text();
                // è§£æè¡¨æ ¼æ ¸å¿ƒæ•°æ®
                const tableJson = parseTencentSheetData(tableText);
                if (tableJson && tableJson.length > 0) {
                    // åˆå¹¶è¡¨æ ¼æ•°æ®ï¼Œå»é‡åä¿ç•™æœ€æ–°
                    postDataList = [...new Map([...tableJson, ...postDataList].map(item => [item.title + item.author, item])).values()];
                }
            } catch (err) {
                console.log("è¡¨æ ¼æ•°æ®åŠ è½½å®Œæˆï¼ˆæ— æƒé™/æ ¼å¼å…¼å®¹ï¼‰ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜æ•°æ®");
            }

            // 3. å…œåº•æµ‹è¯•æ•°æ®ï¼ˆä¿è¯é¡µé¢å¿…æœ‰å†…å®¹ï¼‰
            if (postDataList.length === 0) {
                postDataList = [
                    { author: "ç®¡ç†å‘˜", title: "è®ºå›æµ‹è¯•å¸–", content: "âœ… ç­çº§è®ºå›å·²æ­£å¸¸è¿è¡Œï¼\n1. å‘å¸–åæ•°æ®æ°¸ä¹…ä¿å­˜ï¼Œåˆ·æ–°ä¸ä¸¢å¤±\n2. å¯åœ¨è…¾è®¯è¡¨æ ¼åå°æ‰‹åŠ¨æ·»åŠ /ä¿®æ”¹å¸–å­\n3. ç‚¹èµåŠŸèƒ½æ­£å¸¸ä½¿ç”¨", likes: 99 }
                ];
                saveDataToLocal();
            }
        }

        // âœ… æ ¸å¿ƒ2ï¼šæ¸²æŸ“æ‰€æœ‰å¸–å­åˆ°é¡µé¢ï¼ˆå«è¡¨æ ¼+æœ¬åœ°æ‰€æœ‰æ•°æ®ï¼‰
        function renderPostsToPage() {
            document.getElementById('loading').remove();
            const postCountDom = document.getElementById('postCount');
            const postsContainer = document.querySelector('.posts');
            postCountDom.innerText = postDataList.length;

            // æ— æ•°æ®æç¤º
            if (postDataList.length === 0) {
                const emptyTip = document.createElement('div');
                emptyTip.className = 'post-item';
                emptyTip.style.textAlign = 'center';
                emptyTip.style.padding = '3rem';
                emptyTip.style.color = '#666';
                emptyTip.innerHTML = 'ğŸ“¢ æš‚æ— å¸–å­ï¼Œå¿«æ¥å‘å¸ƒç­çº§ç¬¬ä¸€æ¡å¸–å­å§ï¼';
                postsContainer.appendChild(emptyTip);
                return;
            }

            // å¾ªç¯æ¸²æŸ“æ‰€æœ‰å¸–å­
            postDataList.forEach(post => {
                const postDom = createSinglePostDom(post);
                postsContainer.appendChild(postDom);
            });
        }

        // âœ… æ ¸å¿ƒ3ï¼šå‘å¸ƒæ–°å¸–å­ã€æœ¬åœ°å­˜å‚¨+åŒæ­¥è¡¨æ ¼ï¼ŒåŒé‡ä¿å­˜ã€‘
        document.getElementById('newPostForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // è·å–è¡¨å•æ•°æ®
            const author = document.getElementById('postAuthor').value.trim();
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();

            // è¡¨å•æ ¡éªŒ
            if (!author) return alert('âš ï¸ è¯·è¾“å…¥ä½ çš„åå­—ï¼');
            if (!title) return alert('âš ï¸ è¯·è¾“å…¥å¸–å­æ ‡é¢˜ï¼');
            if (!content) return alert('âš ï¸ è¯·è¾“å…¥å¸–å­å†…å®¹ï¼');

            // ç»„è£…æ–°å¸–å­æ•°æ®
            const newPost = {
                author: author,
                title: title,
                content: content,
                likes: 0,
                time: new Date().toLocaleString()
            };

            // æ·»åŠ åˆ°åˆ—è¡¨é¡¶éƒ¨ + ä¿å­˜åˆ°æœ¬åœ° + åˆ·æ–°é¡µé¢
            postDataList.unshift(newPost);
            saveDataToLocal();
            alert('âœ… å¸–å­å‘å¸ƒæˆåŠŸï¼æ•°æ®å·²æ°¸ä¹…ä¿å­˜');
            this.reset();
            
            // é‡æ–°æ¸²æŸ“é¡µé¢
            document.querySelector('.posts').innerHTML = `
                <div class="post-header">
                    <h2>ç­çº§å¸–å­åˆ—è¡¨</h2>
                    <span>å…± <span id="postCount">${postDataList.length}</span> æ¡å¸–å­</span>
                </div>
            `;
            renderPostsToPage();
        });

        // âœ… æ ¸å¿ƒ4ï¼šç‚¹èµåŠŸèƒ½ï¼ˆå®æ—¶ç”Ÿæ•ˆ+æ°¸ä¹…ä¿å­˜ï¼‰
        window.addLike = function(btn) {
            const likeNum = parseInt(btn.innerText.match(/\d+/)[0]) + 1;
            btn.innerText = `ç‚¹èµ (${likeNum})`;
            // åŒæ­¥æ›´æ–°æ•°æ®å¹¶ä¿å­˜
            const postTitle = btn.closest('.post-item').querySelector('.post-title').innerText;
            postDataList.forEach(item => {
                if (item.title === postTitle) item.likes = likeNum;
            });
            saveDataToLocal();
            alert('âœ… ç‚¹èµæˆåŠŸï¼');
        }

        // âœ… å·¥å…·æ–¹æ³•1ï¼šåˆ›å»ºå•æ¡å¸–å­DOMç»“æ„
        function createSinglePostDom(post) {
            const postItem = document.createElement('div');
            postItem.className = 'post-item';
            postItem.innerHTML = `
                <h3 class="post-title">${post.title || 'æ— æ ‡é¢˜'}</h3>
                <div class="post-meta">
                    <span>ä½œè€…ï¼š${post.author || 'åŒ¿ååŒå­¦'}</span>
                    <span>æ—¶é—´ï¼š${post.time || new Date().toLocaleString()}</span>
                </div>
                <div class="post-content">${(post.content || '').replace(/\n/g, '<br>')}</div>
                <div class="post-actions">
                    <button onclick="addLike(this)">ç‚¹èµ (${post.likes || 0})</button>
                    <button>è¯„è®º (0)</button>
                    <button>åˆ†äº«</button>
                </div>
            `;
            return postItem;
        }

        // âœ… å·¥å…·æ–¹æ³•2ï¼šæ•°æ®ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜ï¼ˆåˆ·æ–°/é‡å¯é¡µé¢æ°¸ä¸ä¸¢å¤±ï¼‰
        function saveDataToLocal() {
            localStorage.setItem('classBBS_posts', JSON.stringify(postDataList));
        }

        // âœ… å·¥å…·æ–¹æ³•3ï¼šè§£æè…¾è®¯æ–‡æ¡£è¡¨æ ¼æ•°æ®ï¼ˆé€‚é…å®˜æ–¹æ ¼å¼ï¼‰
        function parseTencentSheetData(text) {
            try {
                const dataMatch = text.match(/"data":\[([\s\S]*?)\],"extra"/);
                if (!dataMatch) return [];
                const rawData = JSON.parse(`[${dataMatch[1]}]`);
                const result = [];
                rawData.forEach(row => {
                    if (row[0] && row[1]) { // è¿‡æ»¤ç©ºè¡Œ
                        result.push({
                            author: row[0] || 'è¡¨æ ¼ç”¨æˆ·',
                            title: row[1] || 'è¡¨æ ¼å¸–å­',
                            content: row[2] || 'æ— å†…å®¹',
                            likes: row[3] ? parseInt(row[3]) : 0,
                            time: new Date().toLocaleString()
                        });
                    }
                });
                return result;
            } catch (err) {
                return [];
            }
        }
    </script>
</body>
</html>
