<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœé˜³å¤–å›½è¯­17ç­ - ç­çº§è®ºå›</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        /* é¡µé¢ä¸»ä½“ */
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        /* å¤´éƒ¨å¯¼èˆª */
        header {
            background-color: #2c5282;
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .class-title {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            font-size: 1rem;
        }

        .nav-links a:hover {
            color: #e6f7ff;
        }

        /* ä¸»è¦å†…å®¹åŒº */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 2rem;
        }

        /* å…¬å‘Šæ  */
        .notice {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            border-left: 4px solid #4299e1;
        }

        .notice h3 {
            color: #2c5282;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .notice-content {
            color: #555;
            font-size: 0.95rem;
        }

        /* å¸–å­åˆ—è¡¨ */
        .posts {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .post-header {
            padding: 1rem 1.5rem;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-header h2 {
            color: #2c5282;
            font-size: 1.2rem;
        }

        .post-item {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
        }

        .post-item:last-child {
            border-bottom: none;
        }

        .post-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 8px;
        }

        .post-meta {
            font-size: 0.85rem;
            color: #999;
            margin-bottom: 10px;
            display: flex;
            gap: 15px;
        }

        .post-content {
            color: #555;
            margin-bottom: 15px;
        }

        .post-actions {
            display: flex;
            gap: 20px;
            font-size: 0.85rem;
        }

        .post-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .post-actions button:hover {
            color: #4299e1;
        }

        /* å‘å¸–è¡¨å• */
        .post-form {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .post-form h3 {
            color: #2c5282;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        /* æ–°å¢ï¼šä½œè€…è¾“å…¥æ¡†æ ·å¼ */
        .author-input {
            margin-bottom: 15px;
        }
        
        .author-input label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 0.95rem;
        }
        
        .author-input input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95rem;
            resize: vertical;
        }

        .form-group textarea {
            min-height: 120px;
        }

        .submit-btn {
            background-color: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .submit-btn:hover {
            background-color: #3182ce;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .sidebar-card {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .sidebar-card h3 {
            color: #2c5282;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .class-info {
            list-style: none;
        }

        .class-info li {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
        }

        /* åº•éƒ¨ */
        footer {
            background-color: #2c5282;
            color: white;
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 3rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            font-size: 0.9rem;
        }

        /* å“åº”å¼é€‚é…ï¼ˆæ‰‹æœºç«¯ï¼‰ */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }

            .class-title {
                font-size: 1.5rem;
            }

            .header-container {
                flex-direction: column;
                gap: 10px;
            }

            .nav-links {
                margin-top: 10px;
            }
        }
        
        /* åŠ è½½æç¤ºæ ·å¼ */
        .loading {
            padding: 2rem;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header>
        <div class="header-container">
            <div class="class-title">æœé˜³å¤–å›½è¯­17ç­ - ç­çº§è®ºå›</div>
            <nav class="nav-links">
                <a href="#home">é¦–é¡µ</a>
                <a href="#notice">å…¬å‘Š</a>
                <a href="#post">å‘å¸–</a>
                <a href="#contact">è”ç³»æˆ‘ä»¬</a>
            </nav>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒº -->
    <div class="container">
        <!-- å·¦ä¾§ä¸»å†…å®¹ -->
        <div class="main-content">
            <!-- å…¬å‘Šæ  -->
            <section class="notice" id="notice">
                <h3>ç­çº§å…¬å‘Š</h3>
                <div class="notice-content">
                    <p>ğŸ’¬ ã€æé†’ã€‘ç­çº§è®ºå›å·²ä¸Šçº¿ï¼Œæ¬¢è¿å¤§å®¶ç§¯æäº¤æµå­¦ä¹ å¿ƒå¾—ã€åˆ†äº«ç­çº§è¶£äº‹ï¼</p>
                </div>
            </section>

            <!-- å‘å¸–è¡¨å• -->
            <section class="post-form" id="post">
                <h3>å‘å¸ƒæ–°å¸–å­</h3>
                <form id="newPostForm">
                    <!-- æ–°å¢ï¼šä½œè€…è¾“å…¥æ¡† -->
                    <div class="author-input">
                        <label for="postAuthor">ä½ çš„åå­—</label>
                        <input type="text" id="postAuthor" placeholder="è¯·è¾“å…¥ä½ çš„æ˜µç§°/å§“å" required>
                    </div>
                    <div class="form-group">
                        <label for="postTitle">å¸–å­æ ‡é¢˜</label>
                        <input type="text" id="postTitle" placeholder="è¯·è¾“å…¥å¸–å­æ ‡é¢˜ï¼ˆå¦‚ï¼šæ•°å­¦éš¾é¢˜æ±‚åŠ©ã€è¿åŠ¨ä¼šæŠ¥åç­‰ï¼‰" required>
                    </div>
                    <div class="form-group">
                        <label for="postContent">å¸–å­å†…å®¹</label>
                        <textarea id="postContent" placeholder="è¯·è¾“å…¥å¸–å­è¯¦ç»†å†…å®¹..." required></textarea>
                    </div>
                    <button type="submit" class="submit-btn">å‘å¸ƒå¸–å­</button>
                </form>
            </section>

            <!-- å¸–å­åˆ—è¡¨ -->
            <section class="posts" id="home">
                <div class="post-header">
                    <h2>ç­çº§å¸–å­åˆ—è¡¨</h2>
                    <span>å…± <span id="postCount">0</span> æ¡å¸–å­</span>
                </div>
                <!-- åŠ è½½æç¤º -->
                <div class="loading" id="loading">
                    åŠ è½½å¸–å­ä¸­...
                </div>
                <!-- å¸–å­å†…å®¹ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </section>
        </div>

        <!-- å³ä¾§ä¾§è¾¹æ  -->
        <div class="sidebar">
            <!-- ç­çº§ä¿¡æ¯ -->
            <div class="sidebar-card">
                <h3>ç­çº§ä¿¡æ¯</h3>
                <ul class="class-info">
                    <li>å­¦æ ¡ï¼šæœé˜³å¤–å›½è¯­å­¦æ ¡</li>
                    <li>ç­çº§ï¼šåˆä¸€å¹´çº§17ç­</li>
                    <li>ç­ä¸»ä»»ï¼šç‹è€å¸ˆ</li>
                    <li>ç­çº§é‚®ç®±ï¼šcywy17ban@163.com</li>
                    <li>æˆç«‹æ—¶é—´ï¼š2025å¹´12æœˆ</li>
                </ul>
            </div>

            <!-- çƒ­é—¨è¯é¢˜ -->
            <div class="sidebar-card">
                <h3>çƒ­é—¨è¯é¢˜</h3>
                <ul class="class-info">
                    <li>ç­çº§ç”·ç”Ÿå†…æ–—</li>
                    <li>åƒµå°¸ç»„ç»‡è§£æ•£</li>
                    <li>æœå¤–ç¥äººæ¦œå…³é—­</li>
                    <li>æœŸæœ«è€ƒè¯•ä¸´è¿‘</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ -->
    <footer id="contact">
        <div class="footer-content">
            <p>æœé˜³å¤–å›½è¯­17ç­è®ºå› Â© 2025 ç‰ˆæƒæ‰€æœ‰ | æœ¬è®ºå›ä»…ç”¨äºç­çº§å†…éƒ¨äº¤æµ</p>
            <p>è”ç³»æˆ‘ä»¬ï¼šdongpingping@foxmail.com</p>
        </div>
    </footer>

    <!-- å¼•å…¥LeanCloudæ ¸å¿ƒåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.17.0/dist/av-min.js"></script>
    <script>
        // ====================== é…ç½® LeanCloud ï¼ˆå·²å¡«å¥½ä½ çš„ä¿¡æ¯ï¼Œæ— éœ€ä¿®æ”¹ï¼‰======================
        const APP_ID = 'uPiYhiFwUp6oFMi5IKMHUUP-gzGzoHz';
        const APP_KEY = 'Kk5hAxTqGPk2PJpS4MkU9N';
        const SERVER_URL = 'https://uPiYhiFw.api.lncldglobal.com';
        
        // åˆå§‹åŒ– LeanCloud
        AV.init({
            appId: APP_ID,
            appKey: APP_KEY,
            serverURL: SERVER_URL
        });

        // åˆ›å»ºå¸–å­æ•°æ®æ¨¡å‹
        const Post = AV.Object.extend('Post');

        // ====================== æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ======================
        // 1. åŠ è½½æ‰€æœ‰å¸–å­ï¼ˆä¿®å¤ç‰ˆï¼‰
        async function loadPosts() {
            try {
                const query = new AV.Query('Post');
                query.descending('createdAt'); // æœ€æ–°å¸–å­åœ¨æœ€ä¸Šæ–¹
                const posts = await query.find();
                
                // ç§»é™¤åŠ è½½æç¤º
                const loadingDom = document.getElementById('loading');
                if(loadingDom) loadingDom.remove();
                
                const postsList = document.querySelector('.posts');
                const postCount = document.getElementById('postCount');
                postCount.innerText = posts.length;

                // æ— å¸–å­æ—¶æ˜¾ç¤ºæç¤º
                if (posts.length === 0) {
                    const emptyTip = document.createElement('div');
                    emptyTip.className = 'post-item';
                    emptyTip.style.textAlign = 'center';
                    emptyTip.style.padding = '2rem';
                    emptyTip.style.color = '#999';
                    emptyTip.innerHTML = 'æš‚æ— å¸–å­ï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡å§ï¼';
                    postsList.appendChild(emptyTip);
                    return;
                }

                // éå†æ¸²æŸ“æ‰€æœ‰å¸–å­
                posts.forEach(post => {
                    const postData = post.attributes; // ç›´æ¥è·å–æ•°æ®ï¼Œå…¼å®¹æ‰€æœ‰ç‰ˆæœ¬
                    const postItem = createPostElement(postData, post.id);
                    postsList.appendChild(postItem);
                });
            } catch (error) {
                console.error('åŠ è½½å¸–å­å¤±è´¥ï¼š', error);
                document.getElementById('loading').innerHTML = '<span style="color:red;">åŠ è½½å¤±è´¥ï¼Œåˆ·æ–°é‡è¯•</span>';
            }
        }

        // 2. åˆ›å»ºå¸–å­DOMå…ƒç´ ï¼ˆé€‚é…å­—æ®µ+æ ·å¼ï¼‰
        function createPostElement(postData, postId) {
            const postItem = document.createElement('div');
            postItem.className = 'post-item';
            postItem.dataset.postId = postId;
            
            // æ ¼å¼åŒ–å‘å¸ƒæ—¶é—´
            const createTime = new Date(postData.createdAt);
            const formattedTime = `${createTime.toLocaleDateString()} ${createTime.toLocaleTimeString().slice(0,5)}`;

            // å…¼å®¹å­—æ®µï¼šé€‚é…author/nameåŒå­—æ®µï¼Œé¿å…ä¸ºç©º
            const author = postData.author || postData.name || 'åŒ¿åç”¨æˆ·';
            const title = postData.title || 'æ— æ ‡é¢˜';
            const content = (postData.content || '').replace(/\n/g, '<br>');
            const likes = postData.likes || 0;

            postItem.innerHTML = `
                <h3 class="post-title">${title}</h3>
                <div class="post-meta">
                    <span>ä½œè€…ï¼š${author}</span>
                    <span>æ—¶é—´ï¼š${formattedTime}</span>
                </div>
                <div class="post-content">${content}</div>
                <div class="post-actions">
                    <button class="like-btn" data-post-id="${postId}">
                        ç‚¹èµ (${likes})
                    </button>
                    <button>è¯„è®º (0)</button>
                    <button>åˆ†äº«</button>
                </div>
            `;

            // ç‚¹èµæŒ‰é’®ç»‘å®šäº‹ä»¶
            postItem.querySelector('.like-btn').addEventListener('click', handleLike);
            return postItem;
        }

        // 3. ç‚¹èµåŠŸèƒ½ï¼ˆä¿®å¤ç‰ˆï¼‰
        async function handleLike(e) {
            const postId = e.target.closest('.like-btn')?.dataset.postId;
            if (!postId) return;

            try {
                const post = AV.Object.createWithoutData('Post', postId);
                const likeBtn = e.target.closest('.like-btn');
                const currentLikes = parseInt(likeBtn.innerText.match(/\d+/)[0]) || 0;
                
                post.set('likes', currentLikes + 1);
                await post.save();
                likeBtn.innerText = `ç‚¹èµ (${currentLikes + 1})`;
                alert('ç‚¹èµæˆåŠŸï¼');
            } catch (error) {
                console.error('ç‚¹èµå¤±è´¥ï¼š', error);
                alert('ç‚¹èµå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            }
        }

        // 4. å‘å¸ƒæ–°å¸–å­ï¼ˆä¿®å¤ç‰ˆï¼Œå­—æ®µå®Œå…¨åŒ¹é…ï¼‰
        async function publishPost(author, title, content) {
            try {
                const newPost = new Post();
                newPost.set('author', author);  // å’Œè¡¨å•ã€æ•°æ®è¡¨å®Œå…¨åŒ¹é…
                newPost.set('title', title);
                newPost.set('content', content);
                newPost.set('likes', 0);
                await newPost.save();
                alert('å¸–å­å‘å¸ƒæˆåŠŸï¼ğŸ‰');
                location.reload(); // å‘å¸ƒååˆ·æ–°é¡µé¢ï¼Œç«‹å³æ˜¾ç¤ºæ–°å¸–
                return true;
            } catch (error) {
                console.error('å‘å¸ƒå¤±è´¥ï¼š', error);
                alert('å‘å¸ƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é‡è¯•ï¼');
                return false;
            }
        }

        // ====================== äº‹ä»¶ç›‘å¬ ======================
        // é¡µé¢åŠ è½½å®Œæˆè‡ªåŠ¨æ‹‰å–å¸–å­
        window.addEventListener('load', loadPosts);

        // å‘å¸–è¡¨å•æäº¤äº‹ä»¶
        document.getElementById('newPostForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const author = document.getElementById('postAuthor').value.trim();
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();

            // è¡¨å•éªŒè¯
            if (!author) return alert('è¯·è¾“å…¥ä½ çš„åå­—ï¼');
            if (!title) return alert('è¯·è¾“å…¥å¸–å­æ ‡é¢˜ï¼');
            if (!content) return alert('è¯·è¾“å…¥å¸–å­å†…å®¹ï¼');

            // å‘å¸ƒå¸–å­
            await publishPost(author, title, content);
            this.reset(); // æ¸…ç©ºè¡¨å•
        });
    </script>
</body>

</html>
